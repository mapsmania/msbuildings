<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Microsoft Buildings Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.css" rel="stylesheet"/>

    <style>
        body { margin:0; overflow:hidden; }
        #map { width:100%; height:100vh; }
        #info {
            position:absolute; top:10px; left:10px;
            background: white; padding:8px 12px;
            font-size:14px; border-radius:6px;
            box-shadow:0 2px 6px rgba(0,0,0,0.25);
        }
    </style>
</head>
<body>
<div id="info">Microsoft Buildings Demo<br>Service Worker: loadingâ€¦</div>
<div id="map"></div>

<script>
// ðŸŒ Register the real sw.js from the repo root
navigator.serviceWorker.register("./sw.js", { scope: "./" })
    .then(reg => {
        document.getElementById("info").innerHTML =
            "Microsoft Buildings Demo<br>Service Worker: OK âœ”";
        console.log("SW registered:", reg);
    })
    .catch(err => {
        document.getElementById("info").innerHTML =
            "Microsoft Buildings Demo<br>Service Worker: FAILED âœ–";
        console.error("SW registration failed:", err);
    });

// ----- MapLibre -----

const map = new maplibregl.Map({
    container: "map",
    style: {
        version: 8,
        sources: {
            buildings: {
                type: "vector",
                tiles: [
                    // ðŸš¨ This URL MUST MATCH the service workerâ€™s intercept path
                    "quad/{z}/{x}/{y}.geojson"
                ],
                minzoom: 13,
                maxzoom: 17
            }
        },
        layers: [
            {
                id: "buildings",
                type: "fill",
                source: "buildings",
                "source-layer": "default",
                paint: {
                    "fill-color": "#ff5500",
                    "fill-opacity": 0.5
                }
            }
        ]
    },
    center: [23.72, 37.98], // Athens example
    zoom: 14
});
</script>
</body>
</html>
